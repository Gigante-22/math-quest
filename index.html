<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Math Quest - Aventura Matem√°tica</title>
  <style>
    :root {
      --primary-color: #4a6fa5;
      --secondary-color: #ff914d;
      --accent-color: #ff5722;
      --dark-color: #333;
      --light-color: #f8f9fa;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
    }

    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: var(--dark-color);
      position: relative;
      overflow-x: hidden;
    }

    .container {
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      position: relative;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 3px solid var(--primary-color);
      padding-bottom: 20px;
    }

    h1 {
      color: var(--primary-color);
      margin: 0;
      font-size: 2.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      animation: pulse 2s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      100% {
        transform: scale(1.05);
      }
    }

    .difficulty-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .difficulty-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .difficulty-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.3s, height 0.3s;
    }

    .difficulty-btn:hover::before {
      width: 100%;
      height: 100%;
    }

    .difficulty-btn:hover,
    .difficulty-btn.active {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .easy {
      background: linear-gradient(45deg, var(--success-color), #20c997);
      color: white;
    }

    .medium {
      background: linear-gradient(45deg, var(--secondary-color), #fd7e14);
      color: white;
    }

    .hard {
      background: linear-gradient(45deg, var(--danger-color), #e74c3c);
      color: white;
    }

    .stats-container {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .stat-item {
      background: rgba(74, 111, 165, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      text-align: center;
      min-width: 100px;
      margin: 5px;
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .character-level {
      text-align: center;
      margin-bottom: 10px;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .character {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .character img {
      max-width: 150px;
      transition: all 0.3s ease;
      border-radius: 50%;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .character img:hover {
      transform: scale(1.1) rotate(5deg);
    }

    .game-area {
      text-align: center;
    }

    .question-container {
      background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .question-container:hover {
      border-color: var(--primary-color);
      transform: translateY(-2px);
    }

    .question {
      font-size: 1.5rem;
      margin-bottom: 20px;
      font-weight: 600;
      color: var(--dark-color);
    }

    .options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .option-btn {
      padding: 15px;
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      background: white;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .option-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s;
    }

    .option-btn:hover::before {
      left: 100%;
    }

    .option-btn:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(74, 111, 165, 0.3);
    }

    .option-btn.correct {
      background: var(--success-color) !important;
      color: white !important;
      transform: scale(1.05);
      animation: correctPulse 0.6s ease;
    }

    .option-btn.incorrect {
      background: var(--danger-color) !important;
      color: white !important;
      animation: shake 0.5s ease;
    }

    @keyframes correctPulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1.05);
      }
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    .timer,
    .score-display {
      font-size: 1.2rem;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .timer.warning {
      color: var(--danger-color);
      animation: timerWarning 1s infinite;
    }

    @keyframes timerWarning {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .progress-container {
      width: 100%;
      height: 12px;
      background: #e0e0e0;
      border-radius: 10px;
      margin-bottom: 20px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      width: 0%;
      transition: width 0.3s ease;
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: progressShine 2s infinite;
    }

    @keyframes progressShine {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    .feedback {
      margin-top: 15px;
      padding: 15px;
      border-radius: 10px;
      font-weight: bold;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .correct {
      background: linear-gradient(135deg, rgba(40, 167, 69, 0.2), rgba(40, 167, 69, 0.3));
      color: var(--success-color);
      border: 2px solid var(--success-color);
    }

    .incorrect {
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(220, 53, 69, 0.3));
      color: var(--danger-color);
      border: 2px solid var(--danger-color);
    }

    .controls {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    .controls button {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .controls button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.3s, height 0.3s;
    }

    .controls button:hover::before {
      width: 120%;
      height: 120%;
    }

    .start-btn {
      background: linear-gradient(45deg, var(--primary-color), #5a7cb8);
      color: white;
    }

    .next-btn {
      background: linear-gradient(45deg, var(--secondary-color), #ff7f3f);
      color: white;
      display: none;
    }

    .power-ups {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .power-up {
      padding: 10px 15px;
      background: linear-gradient(45deg, var(--accent-color), #ff6b3d);
      color: white;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .power-up:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(255, 87, 34, 0.3);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .power-up.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .xp-container {
      margin: 20px 0;
    }

    .streak-display {
      background: linear-gradient(45deg, var(--warning-color), #ffc947);
      color: var(--dark-color);
      padding: 10px 20px;
      border-radius: 20px;
      font-weight: bold;
      display: inline-block;
      margin: 10px;
      animation: streakGlow 2s infinite alternate;
    }

    @keyframes streakGlow {
      0% {
        box-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
      }

      100% {
        box-shadow: 0 0 20px rgba(255, 193, 7, 0.8);
      }
    }

    .achievements {
      background: rgba(23, 162, 184, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      border: 2px solid var(--info-color);
    }

    .achievement {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 5px 0;
      padding: 8px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 5px;
      transition: all 0.3s ease;
    }

    .achievement.unlocked {
      background: rgba(40, 167, 69, 0.2);
      border-left: 4px solid var(--success-color);
    }

    .achievement.new {
      animation: achievementPop 0.5s ease;
    }

    @keyframes achievementPop {
      0% {
        transform: scale(0.8);
        opacity: 0;
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .combo-display {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      font-weight: bold;
      color: var(--warning-color);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      animation: comboAnimation 1s ease-out;
      pointer-events: none;
      z-index: 1000;
    }

    @keyframes comboAnimation {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }

      50% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }

      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }
    }

    footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #ddd;
      font-size: 0.9rem;
      color: #666;
    }

    @media (max-width: 600px) {
      .options {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 2rem;
      }

      .question {
        font-size: 1.2rem;
      }

      .power-ups {
        flex-direction: column;
        align-items: center;
      }

      .power-up {
        width: 80%;
        justify-content: center;
      }

      .stats-container {
        flex-direction: column;
        align-items: center;
      }

      .stat-item {
        width: 80%;
      }
    }

    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      animation: float 6s infinite linear;
    }

    @keyframes float {
      0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
      }

      10% {
        opacity: 1;
      }

      90% {
        opacity: 1;
      }

      100% {
        transform: translateY(-10vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>

<body>
  <div class="particles" id="particles"></div>

  <div class="container">
    <header>
      <h1>üéØ Math Quest</h1>
      <p>Desafie suas habilidades matem√°ticas nessa aventura √©pica!</p>
    </header>

    <div class="difficulty-selector">
      <button id="btn-easy" class="difficulty-btn easy" onclick="game.setDifficulty('easy')">üü¢ F√°cil</button>
      <button id="btn-medium" class="difficulty-btn medium active" onclick="game.setDifficulty('medium')">üü°
        M√©dio</button>
      <button id="btn-hard" class="difficulty-btn hard" onclick="game.setDifficulty('hard')">üî¥ Dif√≠cil</button>
    </div>

    <div class="stats-container">
      <div class="stat-item">
        <div>N√≠vel</div>
        <div id="level">1</div>
      </div>
      <div class="stat-item">
        <div>üèÜ Recorde</div>
        <div id="high-score">0</div>
      </div>
      <div class="stat-item">
        <div>üî• Melhor Sequ√™ncia</div>
        <div id="best-streak">0</div>
      </div>
    </div>

    <div class="character">
      <img id="character-img" src="https://placehold.co/150?text=üßë‚Äçüè´" alt="Personagem jogador">
    </div>

    <div class="game-area">
      <div id="intro">
        <h2>üöÄ Bem-vindo ao Math Quest!</h2>
        <p>Escolha a dificuldade e clique em "Come√ßar" para iniciar sua jornada matem√°tica.</p>
        <div class="achievements">
          <h3>üèÜ Conquistas</h3>
          <div id="achievements-list"></div>
        </div>
      </div>

      <div id="game" style="display:none;">
        <div class="progress-container">
          <div id="progress-bar" class="progress-bar"></div>
        </div>

        <div class="score-display">
          Pontua√ß√£o: <span id="score">0</span> |
          Pergunta: <span id="question-number">0</span>/10
        </div>

        <div class="streak-display" id="streak-display" style="display:none;">
          üî• Sequ√™ncia: <span id="current-streak">0</span>
        </div>

        <div class="timer">
          ‚è±Ô∏è Tempo: <span id="time">30</span>s
        </div>

        <div class="xp-container">
          XP: <div class="progress-container">
            <div id="xp-bar" class="progress-bar"
              style="background: linear-gradient(90deg, var(--success-color), #20c997)"></div>
          </div>
        </div>

        <div class="question-container">
          <div id="question" class="question"></div>
          <div id="options" class="options"></div>
          <div id="feedback" class="feedback"></div>
        </div>

        <div class="power-ups">
          <div class="power-up" onclick="game.usePowerUp('time')">
            ‚è±Ô∏è +10s (<span id="time-count">3</span>)
          </div>
          <div class="power-up" onclick="game.usePowerUp('hint')">
            üí° Dica (<span id="hint-count">3</span>)
          </div>
          <div class="power-up" onclick="game.usePowerUp('skip')">
            üîÑ Pular (<span id="skip-count">3</span>)
          </div>
        </div>
      </div>

      <div class="controls">
        <button id="start-btn" class="start-btn" onclick="game.startGame()">üéÆ Come√ßar</button>
        <button id="next-btn" class="next-btn" onclick="game.nextQuestion()">‚û°Ô∏è Pr√≥xima</button>
      </div>
    </div>

    <footer>
      <p>üéì Desenvolvido para o trabalho de Fundamentos da Matem√°tica</p>
      <p>¬© 2025 Math Quest - Aprendizado atrav√©s de jogos</p>
    </footer>
  </div>

  <script>
    class MathQuest {
      constructor() {
        this.difficulty = 'medium';
        this.score = 0;
        this.currentQuestion = 0;
        this.totalQuestions = 10;
        this.timer = null;
        this.timeLeft = 30;
        this.correctAnswer = null;
        this.gameStarted = false;
        this.level = 1;
        this.xp = 0;
        this.xpToNextLevel = 100;
        this.currentStreak = 0;
        this.bestStreak = 0;
        this.powerUps = { time: 3, hint: 3, skip: 3 };
        this.audioContext = null;
        this.askedQuestionIndices = {}; // Para armazenar os √≠ndices dos templates de perguntas j√° usados por dificuldade

        this.achievements = {
          firstWin: {
            name: "üéØ Primeira Vit√≥ria",
            description: "Responda sua primeira pergunta corretamente",
            unlocked: false
          },
          speedster: {
            name: "‚ö° Velocista",
            description: "Responda em menos de 5 segundos",
            unlocked: false
          },
          perfectRound: {
            name: "üíØ Rodada Perfeita",
            description: "Acerte todas as 10 perguntas",
            unlocked: false
          },
          streakMaster: {
            name: "üî• Mestre das Sequ√™ncias",
            description: "Consiga uma sequ√™ncia de 5 acertos",
            unlocked: false
          },
          levelUp: {
            name: "üìà Evoluindo",
            description: "Alcance o n√≠vel 5",
            unlocked: false
          },
          powerUser: {
            name: "üîã Usu√°rio Experiente",
            description: "Use todos os power-ups em uma partida",
            unlocked: false
          }
        };

        this.questionTemplates = {
          easy: [
            { template: "Quanto √© {a} + {b}?", answer: (a, b) => a + b },
            { template: "Quanto √© {a} - {b}?", answer: (a, b) => a - b },
            { template: "Se um pacote tem {a} balas e {b} s√£o retiradas, quantas restam?", answer: (a, b) => a - b },
            { template: "Jo√£o tem {a} ma√ß√£s e ganha mais {b}. Quantas ma√ß√£s ele tem agora?", answer: (a, b) => a + b },
            { template: "Quanto √© {a} √ó {b}?", answer: (a, b) => a * b, param: () => ({ a: Math.floor(Math.random() * 5) + 1, b: Math.floor(Math.random() * 5) + 1 }) },
            { template: "Em uma sala h√° {a} fileiras com {b} cadeiras cada. Quantas cadeiras h√° no total?", answer: (a, b) => a * b, param: () => ({ a: Math.floor(Math.random() * 5) + 2, b: Math.floor(Math.random() * 5) + 2 }) }
          ],
          medium: [
            { template: "Quanto √© {a} √ó {b}?", answer: (a, b) => a * b },
            {
              template: "Quanto √© {a} √∑ {b}?", answer: (a, b) => a / b, param: () => {
                const b = Math.floor(Math.random() * 5) + 2;
                const a = b * (Math.floor(Math.random() * 10) + 1);
                return { a, b };
              }
            },
            { template: "Qual √© {a}% de {b}?", answer: (a, b) => (a * b) / 100, param: () => ({ a: Math.floor(Math.random() * 9 + 1) * 10, b: Math.floor(Math.random() * 90) + 10 }) },
            {
              template: "Qual √© a raiz quadrada de {a_squared}?", answer: (a) => a, param: () => {
                const a = Math.floor(Math.random() * 10) + 1;
                return { a_squared: a * a, a };
              }
            },
            {
              template: "Se {a} laranjas custam R$ {b}, quanto custam {c} laranjas?", answer: (a, b, c) => (b * c) / a, param: () => {
                const a = Math.floor(Math.random() * 5) + 2;
                const b = Math.floor(Math.random() * 20) + 5;
                const c = Math.floor(Math.random() * 10) + 1;
                return { a, b, c };
              }
            },
            { template: "Qual √© o dobro de {a}?", answer: (a) => a * 2 }
          ],
          hard: [
            {
              template: "Qual √© o fatorial de {a}?", answer: (a) => {
                let result = 1;
                for (let i = 2; i <= a; i++) result *= i;
                return result;
              }, param: () => ({ a: Math.floor(Math.random() * 4) + 3 })
            },
            { template: "Quanto √© {a}¬≥?", answer: (a) => a * a * a },
            { template: "Qual √© a m√©dia aritm√©tica de {a}, {b} e {c}?", answer: (a, b, c) => (a + b + c) / 3, param: () => ({ a: Math.floor(Math.random() * 20) + 1, b: Math.floor(Math.random() * 20) + 1, c: Math.floor(Math.random() * 20) + 1 }) },
            {
              template: "Se 2^a = {result}, qual √© o valor de a?", // 'a' agora √© um caractere literal
              answer: (result_val, exponent_val) => exponent_val, // A resposta √© o valor do expoente
              param: () => {
                const a_value = Math.floor(Math.random() * 6) + 1;
                const result_value = Math.pow(2, a_value);
                // 'exponent_answer' √© o valor real do expoente, n√£o usado no template da pergunta
                return { result: result_value, exponent_answer: a_value };
              }
            },

            {
              template: "Qual √© o pr√≥ximo n√∫mero na sequ√™ncia: {a}, {b}, {c}, ?", answer: (a, b, c) => c + (c - b), param: () => {
                const diff = Math.floor(Math.random() * 5) + 2;
                const a = Math.floor(Math.random() * 10) + 1;
                return { a, b: a + diff, c: a + 2 * diff };
              }
            },
            { template: "Qual √© a √°rea de um quadrado com lado {a}?", answer: (a) => a * a }
          ]
        };
      }

      init() {
        this.setupAudio();
        this.createParticles();
        this.setDifficulty('medium');
        this.updateHighScore();
        this.loadAchievements();
        this.displayAchievements();
      }

      setupAudio() {
        try {
          this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          console.log('Audio n√£o suportado');
        }
      }

      createParticles() {
        const particlesContainer = document.getElementById('particles');
        for (let i = 0; i < 50; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.animationDelay = Math.random() * 6 + 's';
          particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
          particlesContainer.appendChild(particle);
        }
      }

      playSound(type) {
        if (!this.audioContext) return;

        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);

        const frequencies = {
          correct: 800,
          incorrect: 200,
          levelUp: 1000,
          powerUp: 600,
          achievement: 900
        };

        oscillator.frequency.value = frequencies[type] || 400;
        gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);

        oscillator.start();
        oscillator.stop(this.audioContext.currentTime + 0.3);
      }

      setDifficulty(levelSel) {
        // Troca a imagem do personagem conforme a dificuldade escolhida
        this.difficulty = levelSel;
        document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`btn-${levelSel}`).classList.add('active');

        // IMAGEM DO PERSONAGEM POR DIFICULDADE
        const images = {
          easy: 'https://placehold.co/150?text=üßí',
          medium: 'https://placehold.co/150?text=üßë‚Äçüè´',
          hard: 'https://placehold.co/150?text=üß†'
        };
        document.getElementById('character-img').src = images[levelSel];
      }

      startGame() {
        document.getElementById('intro').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';

        this.score = 0;
        this.currentQuestion = 0;
        this.level = 1;
        this.xp = 0;
        this.xpToNextLevel = 100;
        this.currentStreak = 0;
        this.powerUps = { time: 3, hint: 3, skip: 3 };
        this.gameStarted = true;
        this.askedQuestionIndices[this.difficulty] = []; // Resetar perguntas feitas para a dificuldade atual

        this.updateStats();
        this.updateCounters();
        this.updateHighScore();
        this.generateQuestion();
        this.startTimer();
      }

      generateQuestion() {
        this.currentQuestion++;
        if (this.currentQuestion > this.totalQuestions) {
          return this.endGame();
        }

        document.getElementById('question-number').textContent = this.currentQuestion;
        document.getElementById('progress-bar').style.width = `${(this.currentQuestion / this.totalQuestions) * 100}%`;

        const templates = this.questionTemplates[this.difficulty];
        let availableTemplatesIndices = templates
          .map((_, index) => index)
          .filter(index => !this.askedQuestionIndices[this.difficulty].includes(index));

        // Se todos os templates para esta dificuldade foram usados, resetar a lista
        if (availableTemplatesIndices.length === 0) {
          this.askedQuestionIndices[this.difficulty] = [];
          availableTemplatesIndices = templates.map((_, index) => index);
        }

        const randomIndex = availableTemplatesIndices[Math.floor(Math.random() * availableTemplatesIndices.length)];
        const template = templates[randomIndex];

        // Adicionar o √≠ndice original do template escolhido √† lista de perguntas feitas
        this.askedQuestionIndices[this.difficulty].push(randomIndex);

        let params = {
          a: Math.floor(Math.random() * 10) + 1,
          b: Math.floor(Math.random() * 10) + 1
        };

        if (template.param) {
          params = { ...params, ...template.param() };
        }

        let questionText = template.template;
        Object.keys(params).forEach(key => {
          questionText = questionText.replace(`{${key}}`, params[key]);
        });

        this.correctAnswer = template.answer(...Object.values(params));
        document.getElementById('question').textContent = questionText;

        const optionsEl = document.getElementById('options');
        optionsEl.innerHTML = '';

        let options = [this.correctAnswer];
        while (options.length < 4) {
          let wrongAnswer = this.correctAnswer + Math.floor(Math.random() * 10 + 1) * (Math.random() > 0.5 ? 1 : -1);
          if (!options.includes(wrongAnswer) && wrongAnswer > 0) {
            options.push(wrongAnswer);
          }
        }

        this.shuffleArray(options).forEach(option => {
          const btn = document.createElement('button');
          btn.className = 'option-btn';
          btn.textContent = option;
          btn.onclick = () => this.checkAnswer(option);
          optionsEl.appendChild(btn);
        });

        this.timeLeft = 30;
        document.getElementById('time').textContent = this.timeLeft;
        document.getElementById('feedback').style.display = 'none';
        this.updateXPBar();
      }

      checkAnswer(answer) {
        clearInterval(this.timer);
        const feedback = document.getElementById('feedback');
        const isCorrect = parseFloat(answer) === parseFloat(this.correctAnswer);

        // Destacar resposta correta/incorreta
        document.querySelectorAll('.option-btn').forEach(btn => {
          btn.onclick = null;
          if (parseFloat(btn.textContent) === parseFloat(this.correctAnswer)) {
            btn.classList.add('correct');
          } else if (parseFloat(btn.textContent) === parseFloat(answer) && !isCorrect) {
            btn.classList.add('incorrect');
          }
        });

        if (isCorrect) {
          this.playSound('correct');
          this.currentStreak++;
          this.bestStreak = Math.max(this.bestStreak, this.currentStreak);

          feedback.className = 'feedback correct';
          feedback.textContent = '‚úÖ Correto!';

          const basePoints = this.difficulty === 'easy' ? 10 : this.difficulty === 'medium' ? 20 : 30;
          const timeBonus = Math.floor(this.timeLeft / 3);
          const streakBonus = this.currentStreak > 1 ? this.currentStreak * 5 : 0;
          const points = basePoints + timeBonus + streakBonus;

          this.score += points;
          this.xp += points;

          // Mostrar combo se streak > 2
          if (this.currentStreak > 2) {
            this.showCombo();
          }

          // Verificar level up
          if (this.xp >= this.xpToNextLevel) {
            this.levelUp();
          }

          // Verificar conquistas
          this.checkAchievements(isCorrect);

        } else {
          this.playSound('incorrect');
          this.currentStreak = 0;
          feedback.className = 'feedback incorrect';
          feedback.textContent = `‚ùå Errado! Resposta: ${this.correctAnswer}`;
        }

        feedback.style.display = 'block';
        document.getElementById('next-btn').style.display = 'inline-block';
        this.updateStats();
        this.updateStreakDisplay();
      }

      levelUp() {
        this.level++;
        this.xp -= this.xpToNextLevel;
        this.xpToNextLevel += 50;
        this.playSound('levelUp');

        // Efeito visual de level up
        const levelEl = document.getElementById('level');
        levelEl.style.animation = 'correctPulse 0.6s ease';
        setTimeout(() => {
          levelEl.style.animation = '';
        }, 600);

        // Restaurar um power-up aleat√≥rio
        const powerUpTypes = ['time', 'hint', 'skip'];
        const randomPowerUp = powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)];
        this.powerUps[randomPowerUp]++;
        this.updateCounters();
      }

      showCombo() {
        const comboEl = document.createElement('div');
        comboEl.className = 'combo-display';
        comboEl.textContent = `üî• ${this.currentStreak}x COMBO!`;
        document.querySelector('.container').appendChild(comboEl);

        setTimeout(() => {
          comboEl.remove();
        }, 1000);
      }

      nextQuestion() {
        document.getElementById('next-btn').style.display = 'none';
        this.generateQuestion();
        this.startTimer();
      }

      startTimer() {
        clearInterval(this.timer);
        const timerEl = document.getElementById('time');
        timerEl.parentElement.classList.remove('warning');

        this.timer = setInterval(() => {
          this.timeLeft--;
          timerEl.textContent = this.timeLeft;

          if (this.timeLeft <= 10) {
            timerEl.parentElement.classList.add('warning');
          }

          if (this.timeLeft <= 0) {
            clearInterval(this.timer);
            this.currentStreak = 0;
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback incorrect';
            feedback.textContent = '‚è∞ Tempo esgotado!';
            feedback.style.display = 'block';
            document.getElementById('next-btn').style.display = 'inline-block';
            this.updateStreakDisplay();
          }
        }, 1000);
      }

      updateStats() {
        document.getElementById('score').textContent = this.score;
        document.getElementById('level').textContent = this.level;
        document.getElementById('best-streak').textContent = this.bestStreak;
        this.updateCounters();
        this.updateXPBar();
      }

      updateStreakDisplay() {
        const streakDisplay = document.getElementById('streak-display');
        const currentStreakEl = document.getElementById('current-streak');

        if (this.currentStreak > 0) {
          streakDisplay.style.display = 'inline-block';
          currentStreakEl.textContent = this.currentStreak;
        } else {
          streakDisplay.style.display = 'none';
        }
      }

      endGame() {
        clearInterval(this.timer);
        this.gameStarted = false;

        // Verificar conquista de rodada perfeita
        if (this.currentStreak === this.totalQuestions) {
          this.unlockAchievement('perfectRound');
        }

        const feedback = document.getElementById('feedback');
        feedback.className = 'feedback';
        feedback.innerHTML = `
          <h3>üéâ Fim do jogo!</h3>
          <p>Pontua√ß√£o: <strong>${this.score}</strong></p>
          <p>N√≠vel alcan√ßado: <strong>${this.level}</strong></p>
          <p>Melhor sequ√™ncia: <strong>${this.bestStreak}</strong></p>
        `;
        feedback.style.display = 'block';

        document.getElementById('question').textContent = 'Parab√©ns! Voc√™ completou o Math Quest!';
        document.getElementById('options').innerHTML = '';
        document.getElementById('next-btn').style.display = 'none';
        document.getElementById('start-btn').textContent = 'üîÑ Jogar Novamente';
        document.getElementById('start-btn').style.display = 'inline-block';

        this.saveHighScore();
        this.saveAchievements();
      }

      usePowerUp(type) {
        if (this.powerUps[type] <= 0) {
          return alert('‚ùå Sem usos restantes!');
        }

        this.powerUps[type]--;
        this.updateCounters();
        this.playSound('powerUp');

        // Verificar se usou todos os power-ups
        if (this.powerUps.time === 2 && this.powerUps.hint === 2 && this.powerUps.skip === 2) {
          this.unlockAchievement('powerUser');
        }

        if (type === 'time') {
          this.timeLeft += 10;
          document.getElementById('time').textContent = this.timeLeft;

        } else if (type === 'hint') {
          const buttons = document.querySelectorAll('.option-btn');
          let wrongAnswers = 0;

          buttons.forEach(btn => {
            if (parseFloat(btn.textContent) !== parseFloat(this.correctAnswer) && wrongAnswers < 2) {
              btn.style.opacity = '0.3';
              btn.style.pointerEvents = 'none';
              wrongAnswers++;
            }
          });

        } else if (type === 'skip') {
          clearInterval(this.timer);
          const feedback = document.getElementById('feedback');
          feedback.className = 'feedback';
          feedback.textContent = '‚Ü©Ô∏è Pergunta pulada!';
          feedback.style.display = 'block';
          document.getElementById('next-btn').style.display = 'inline-block';
          this.currentStreak = 0;
          this.updateStreakDisplay();
        }
      }

      updateCounters() {
        document.getElementById('time-count').textContent = this.powerUps.time;
        document.getElementById('hint-count').textContent = this.powerUps.hint;
        document.getElementById('skip-count').textContent = this.powerUps.skip;

        // Atualizar visual dos power-ups
        document.querySelectorAll('.power-up').forEach((powerUp, index) => {
          const types = ['time', 'hint', 'skip'];
          const type = types[index];

          if (this.powerUps[type] <= 0) {
            powerUp.classList.add('disabled');
          } else {
            powerUp.classList.remove('disabled');
          }
        });
      }

      updateXPBar() {
        const xpBar = document.getElementById('xp-bar');
        const percentage = (this.xp / this.xpToNextLevel) * 100;
        xpBar.style.width = `${percentage}%`;
      }

      checkAchievements(isCorrect) {
        // Primeira vit√≥ria
        if (isCorrect && !this.achievements.firstWin.unlocked) {
          this.unlockAchievement('firstWin');
        }

        // Velocista (resposta em menos de 5 segundos)
        if (isCorrect && this.timeLeft > 25 && !this.achievements.speedster.unlocked) {
          this.unlockAchievement('speedster');
        }

        // Mestre das sequ√™ncias
        if (this.currentStreak >= 5 && !this.achievements.streakMaster.unlocked) {
          this.unlockAchievement('streakMaster');
        }

        // Evoluindo
        if (this.level >= 5 && !this.achievements.levelUp.unlocked) {
          this.unlockAchievement('levelUp');
        }
      }

      unlockAchievement(achievementKey) {
        if (this.achievements[achievementKey].unlocked) return;

        this.achievements[achievementKey].unlocked = true;
        this.playSound('achievement');

        // Mostrar notifica√ß√£o
        const notification = document.createElement('div');
        notification.innerHTML = `
          <div style="position: fixed; top: 20px; right: 20px; background: linear-gradient(45deg, #28a745, #20c997); color: white; padding: 15px; border-radius: 10px; z-index: 1000; animation: slideIn 0.5s ease;">
            <h4>üèÜ Conquista Desbloqueada!</h4>
            <p><strong>${this.achievements[achievementKey].name}</strong></p>
            <p>${this.achievements[achievementKey].description}</p>
          </div>
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.remove();
        }, 4000);

        this.displayAchievements();
      }

      displayAchievements() {
        const achievementsList = document.getElementById('achievements-list');
        achievementsList.innerHTML = '';

        Object.keys(this.achievements).forEach(key => {
          const achievement = this.achievements[key];
          const div = document.createElement('div');
          div.className = `achievement ${achievement.unlocked ? 'unlocked' : ''}`;
          div.innerHTML = `
            <span>${achievement.unlocked ? 'üèÜ' : 'üîí'}</span>
            <div>
              <strong>${achievement.name}</strong>
              <div style="font-size: 0.9em; opacity: 0.8;">${achievement.description}</div>
            </div>
          `;
          achievementsList.appendChild(div);
        });
      }

      shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      getHighScore() {
        return parseInt(localStorage.getItem('mathQuestHighScore')) || 0;
      }

      saveHighScore() {
        const highScore = this.getHighScore();
        if (this.score > highScore) {
          localStorage.setItem('mathQuestHighScore', this.score);
        }
        this.updateHighScore();
      }

      updateHighScore() {
        document.getElementById('high-score').textContent = this.getHighScore();
      }

      saveAchievements() {
        localStorage.setItem('mathQuestAchievements', JSON.stringify(this.achievements));
      }

      loadAchievements() {
        const saved = localStorage.getItem('mathQuestAchievements');
        if (saved) {
          const savedAchievements = JSON.parse(saved);
          Object.keys(savedAchievements).forEach(key => {
            if (this.achievements[key]) {
              this.achievements[key].unlocked = savedAchievements[key].unlocked;
            }
          });
        }
      }
    }

    // Inicializar o jogo
    const game = new MathQuest();
    window.onload = () => game.init();

    // Adicionar estilo para a notifica√ß√£o
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>

</html>
